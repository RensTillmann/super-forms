<!DOCTYPE html>
<html dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Color Picker</title>
    <link href="color-picker.min.css" rel="stylesheet">
    <script src="color-picker.js"></script>
    <style>
      .super-color-picker {
          border: 1px solid red;
      }
      .super-picker-box {
          border: 1px solid black;
          width: 16px;
          height: 16px;
          display: block;
          /* background-color: #000; */
          padding: 1px;
          float: left;
          margin:10px;
      } 
      .super-picker-color {
          width: 12px;
          height: 12px;
          display: block;
          background-color: #ff7474;
          padding: 2px;
          float: left;
      } 
      .super-picker-value {
        display:none;
      }
      .super-color-code {
          width: 100%;
      }
      .super-picker-alpha {
          width: 98%;
      }
      .super-color-picker .super-picker-value,
      .super-color-picker .super-color-code,
      .super-color-picker .super-picker-alpha {
          display:none;
      }
    </style>
  </head>
  <body>
    <div class="super-color-picker">
        <div class="super-picker-box">
            <span class="super-picker-color"></span>
        </div>
        <input class="super-picker-value" type="text" value="#000000" disabled="disabled" />
        <input class="super-picker-alpha" type="range" min="0" max="1" step=".01" value="1" />
        <input class="super-color-code" type="text" value="#000000" />
    </div>
    <script>

      const input = document.querySelector('.super-color-picker > .super-picker-value'),
            box = document.querySelector('.super-color-picker > .super-picker-box'),
            alpha = document.querySelector('.super-color-picker > .super-picker-alpha'),
            code = document.querySelector('.super-color-picker > .super-color-code');

      function copy_code_to_value(){
          console.log('test1');
          input.value = code.value;
          if(code.value.indexOf('rgb')!=-1){
            picker.fire('change', [code.value, true]);
          }else{
            picker.fire('change', [code.value.slice(1), true]);
          }
      }
      code.onkeyup = copy_code_to_value;
      code.onchange = copy_code_to_value;
      code.oninput = copy_code_to_value;

      box.addEventListener('click', function(e) {
          console.log('test2');
          if(this.classList.contains('active')){
              if(picker.visible){
                  picker['exit']();
              }
          }
          this.classList.toggle('active');
      }, false);
      var picker = new CP(box);
      picker.on('change', function(color, copy=false) {
          console.log('test3');
          console.log(color);
          console.log(copy);
          var v = CP.HEX2RGB(color);
          v = alpha.value == 1 ? '#'+color : 'rgba(' + v.join(', ') + ', ' + alpha.value.replace(/^0\./, '.') + ')';
          this.source.value = v;
          this.source.querySelector('.super-picker-color').style.backgroundColor = v;
          input.value = v;
          if(copy!==true){
            code.value = v;
          }
          if(copy===true){
            picker.set(v);
          }
          //picker.set(color);

          /*if(input.value==''){
            var color = '000000';
          }

          if( (copy===true) && (input.value.indexOf('#')!=-1) ) {
            var v = input.value;
            // Also update alpha slider value to be 1
            alpha.value = 1;
          }else{
            // If is rgb input and copied input
            if( copy===true ) {
              var v = input.value;
            }else{
              if(input.value=='' && code.value==''){
                var color = '000000';
              }else{
                console.log(code);
                console.log(input);
                var color = input.value.replace('#','');
              }
              console.log(copy);
              console.log(color);
              if(copy!==true){
                if(color.indexOf('rgb')!=-1) {
                  console.log('RGB Color');
                }else{
                  var v = '#'+color;
                  console.log('HEX Color');
                }
              }else{
                var v = input.value;
              }

              /*
              var v = input.value;
              var v = CP.HEX2RGB(color);
              console.log(v);
              console.log(color);
              v = alpha.value == 1 ? '#'+color : 'rgba(' + v.join(', ') + ', ' + alpha.value.replace(/^0\./, '.') + ')';
              console.log(v);
              */
              //var v = input.value;
            //}
            //console.log(color);
            //console.log(v);
            //if(copy===true){
              // rgba(89, 22, 22, .69)
              //console.log(input.value);
              //console.log(code.value);
              //console.log(color);
              //console.log(v);
            //}
            //input.value = v;
            //code.value = v;
          //}
          //this.source.value = v;
          //this.source.querySelector('.super-picker-color').style.backgroundColor = v;
          //if(copy===true) {
          //  picker.set(v);
          //}

          //picker.set(color);
          /*
          console.log('test6');
          if(input.value.indexOf('rgb')!=-1){
            var v = input.value;
          }else{
            var v = CP.HEX2RGB(input.value.slice(1));
            v = alpha.value == 1 ? '#'+color : 'rgba(' + v.join(', ') + ', ' + alpha.value.replace(/^0\./, '.') + ')';
          }
          console.log(v);
          //picker.set(v);
          this.source.value = v;
          this.source.querySelector('.super-picker-color').style.backgroundColor = v;
          code.value = v;
          */
      });
      function alpha_change() {
          console.log('test4');
          var v = CP._HSV2RGB(picker.set());
          v = this.value == 1 ? '#'+CP.RGB2HEX(v) : 'rgba(' + v.join(', ') + ', ' + this.value.replace(/^0\./, '.') + ')';
          picker.source.value = v;
          picker.source.querySelector('.super-picker-color').style.backgroundColor = v;
          code.value = v;
          input.value = v;
      }
      alpha.onchange = alpha_change;
      alpha.oninput = alpha_change;

      picker.source.onclick = function(e) {
          console.log('test5');
          e.preventDefault();
      };
      picker.on('enter', function() {
          console.log('test6');
          picker.self.firstChild.appendChild(code);
          picker.self.firstChild.appendChild(input);
          picker.self.firstChild.appendChild(alpha);
      });
      picker.on('exit', function() {
          console.log('test7');
          box.classList.toggle('active');
          box.parentNode.appendChild(code);
          box.parentNode.appendChild(input);
          box.parentNode.appendChild(alpha);
      });


      /*function update_code() {
          console.log('test8');
          if (this.value.length) {
              picker.set(this.value);
              picker.fire("change", [this.value.slice(1)]);
          }
      }
      code.oncut = update_code;
      code.onpaste = update_code;
      code.onkeyup = update_code;
      code.oninput = update_code;
      */


      /*


      const input = document.querySelector('.super-color-picker > .super-picker-value'),
            box = document.querySelector('.super-color-picker > .super-picker-box'),
            alpha = document.querySelector('.super-color-picker > .super-picker-alpha');

      box.addEventListener('click', function(e) {
        if(this.classList.contains('active')){
          if(picker.visible){
            picker['exit']();
          }
        }
        this.classList.toggle('active');
      }, false);
      var picker = new CP(box);
      picker.on('exit',function(){
        box.classList.toggle('active');
      });
      picker.on('change', function(color) {
          var v = CP.HEX2RGB(color);
          v = alpha.value == 1 ? '#'+color : 'rgba(' + v.join(', ') + ', ' + alpha.value.replace(/^0\./, '.') + ')';
          this.source.value = v;
          this.source.querySelector('.super-picker-color').style.backgroundColor = v;
          input.value = v;
      });
      function alpha_change() {
          var v = CP._HSV2RGB(picker.set());
          v = this.value == 1 ? '#'+CP.RGB2HEX(v) : 'rgba(' + v.join(', ') + ', ' + this.value.replace(/^0\./, '.') + ')';
          picker.source.value = v;
          picker.source.querySelector('.super-picker-color').style.backgroundColor = v;
          input.value = v;
      }
      alpha.onchange = alpha_change;
      alpha.oninput = alpha_change;


      picker.source.onclick = function(e) {
          e.preventDefault();
      };
      picker.on('enter', function() {
          picker.self.firstChild.appendChild(input);
          input.value = '#' + CP._HSV2HEX(this.get());
      });
      picker.on('exit', function() {
          alpha.parentNode.appendChild(input);
      });

      picker.on('change', function(color) {
          this.source.value = '#' + color;
          input.value = '#' + color;
      });
      //picker.self.firstChild.appendChild(code);
      function update_value() {
          if (this.value.length) {
              picker.set(this.value);
              //picker.fire('change', [this.value.slice(1)]);
          }
      }
      input.oncut = update_value;
      input.onpaste = update_value;
      input.onkeyup = update_value;
      input.oninput = update_value;

            picker = new CP(document.querySelector('input')),
            alpha = document.createElement('input'),
            button = document.querySelector('.super-picker-button'),
            button_text = button.innerHTML;

      input.parentNode.insertBefore(box, input);
      input.type = 'hidden';


      button.addEventListener('click', function(e) {
          picker[picker.visible ? 'exit' : 'enter']();
          this.innerHTML = picker.visible ? 'Close' : button_text;
      }, false);

      picker.on('change', function(color) {
          this.source.value = '#' + color;
      });
      function update() {
        if(this.value.indexOf('#')!=-1){
          var rgb = CP.HEX2RGB(this.value.replace('#',''));
          if(typeof rgb[3] !== 'undefined'){
            var color = rgb[3] == 1 ? '#'+hex : 'rgba(' + v.join(', ') + ', ' + rgb[3].replace(/^0\./, '.') + ')';
            picker.set(color).enter();
          }else{
            picker.set(this.value).enter();
          }
        }
      }
      picker.source.oncut = update;
      picker.source.onpaste = update;
      picker.source.onkeyup = update;
      picker.source.onchange = update;
      picker.source.oninput = update;
      function change() {
          var v = CP._HSV2RGB(picker.set());
          v = this.value == 1 ? '#'+CP.RGB2HEX(v) : 'rgba(' + v.join(', ') + ', ' + this.value.replace(/^0\./, '.') + ')';
          picker.source.value = v;
          document.body.style.backgroundColor = v;
      }
      alpha.type = 'range';
      alpha.min = 0;
      alpha.max = 1;
      alpha.step = .01;
      alpha.value = 1; // opaque
      alpha.onchange = change;
      alpha.oninput = change;
      picker.self.appendChild(alpha);
      picker.on('change', function(color) {
          var v = CP.HEX2RGB(color);
          v = alpha.value == 1 ? '#'+color : 'rgba(' + v.join(', ') + ', ' + alpha.value.replace(/^0\./, '.') + ')';
          this.source.value = v;
          document.body.style.backgroundColor = v;
      });
      */
    </script>
  </body>
</html>