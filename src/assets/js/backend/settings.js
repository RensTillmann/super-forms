jQuery,jQuery(document).ready(function(o){var e=o(document);SUPER.init_image_browser(),e.on("click",'.super-checkbox input[type="checkbox"]',function(){var e=o(this).parents(".super-checkbox:eq(0)"),t=e.parent().children(".element-field"),s="",a=0;e.find('input[type="checkbox"]').each(function(){1==o(this).prop("checked")&&(s+=0==a?o(this).val():","+o(this).val(),a++)}),t.val(s)});var s="dd-mm-yy",t=o('.super-export-import-entries input[name="from"]').datepicker({dateFormat:s,changeYear:!0,defaultDate:"+1w",beforeShow:function(e,t){o(t).datepicker("widget").addClass("super-datepicker-dialog")}}).on("change",function(){a.datepicker("option","minDate",getDate(this))}),a=o('.super-export-import-entries input[name="till"]').datepicker({dateFormat:s,changeYear:!0,defaultDate:"+1w",beforeShow:function(e,t){o(t).datepicker("widget").addClass("super-datepicker-dialog")}}).on("change",function(){t.datepicker("option","maxDate",getDate(this))});function getDate(e){var t;try{t=o.datepicker.parseDate(s,e.value)}catch(e){t=null}return t}if(o(".browse-csv-import-file").each(function(){var e,t=o(this),s=t.children(".button"),a=t.children(".file-preview"),i=t.children("input"),r=i.val();a.on("click","a.delete",function(){i.val(""),a.html("")}),s.on("click",function(){o(".ui-widget-overlay").hide(),t.parents(".shortcode-dialog").hide(),e||((e=wp.media.frames.downloadable_file=wp.media({title:"Select a CSV file",button:{text:"Add CSV"},library:{type:"text/csv"},multiple:!1})).on("select",function(){e.state().get("selection").map(function(s){if("text/csv"!=(s=s.toJSON()).mime)alert("Selected file is not a CSV file!");else if(s.id){r=s.id;var e=o('input[name="import_delimiter"]').val(),t=o('input[name="import_enclosure"]').val();o.ajax({type:"post",url:ajaxurl,data:{action:"super_prepare_contact_entry_import",file_id:r,import_delimiter:e,import_enclosure:t},success:function(e){var t=jQuery.parseJSON(e);$html="",$html+='<div class="image"><img src="'+s.icon+'" /></div>',$html+=s.filename,$html+='<a href="#" class="delete">Delete</a>',$html+='<ul class="import-column-connections">',o.each(t,function(e,t){$html+="<li>",$dropdown='<select name="column">',$dropdown+='<option value="var">VARCHAR (default)</option>',$dropdown+='<option value="text">TEXT</option>';var s=t.toLowerCase();$dropdown+="post author"==s||"post_author"==s||"author"==s||"author_id"==s||"author id"==s||"user_id"==s||"user id"==s||"user"==s||"id"==s?'<option value="post_author" selected="selected">Author (User ID)</option>':'<option value="post_author">Author (User ID)</option>',$dropdown+="post_title"==s||"post title"==s||"entry title"==s||"title"==s||"name"==s?'<option value="post_title" selected="selected">Contact Entry Title (Post Title)</option>':'<option value="post_title">Contact Entry Title (Post Title)</option>',$dropdown+="date"==s||"post_date"==s||"post date"==s||"publish_date"==s||"publish date"==s?'<option value="post_date" selected="selected">Date (publish date)</option>':'<option value="post_date">Date (publish date)</option>',$dropdown+="ip"==s||"ip_address"==s||"ip address"==s?'<option value="ip_address" selected="selected">IP address</option>':'<option value="ip_address">IP address</option>',$dropdown+="form"==s||"form_id"==s||"form id"==s?'<option value="form_id" selected="selected">Form ID</option>':'<option value="form_id">Form ID</option>',$dropdown+="file"==s||"files"==s||"image"==s||"images"==s?'<option value="file" selected="selected">File / Image</option>':'<option value="file">File / Image</option>',$dropdown+="</select>",$html+="<label><span>Save as: </span>"+$dropdown+"</label>",$html+='<label><span>Field Label: </span><input type="text" name="label" value="'+t+'" /></label>',$html+='<label><span>Field Name: </span><input type="text" name="name" value="'+t+'" /></label>',$html+="</li>"}),$html+="</ul>",$html+='<div class="delimiter-enclosure">',$html+='<span>Delimiter:</span> <input type="text" value="," name="import_delimiter" />',$html+='<span>Enclosure:</span> <input type="text" value="'+String('"').replace(/"/g,"&quot;")+'" name="import_enclosure" />',$html+="</div>",$html+='<label class="skip-first-row"><input type="checkbox" name="skip_first" /> Skip the first row of the CSV file</label>',$html+='<span class="button super-button super-import-contact-entries"><i class="fa fa-cogs"></i> Click here to start the Import</span>',a.html($html)}})}}),i.val(r)}),e.on("close",function(){o(".ui-widget-overlay").show(),t.parents(".shortcode-dialog").show()})),e.open()})}),e.on("click",".super-import-contact-entries",function(){var e=o('input[name="csv_import_file"]').val(),i={},r=0;o(".import-column-connections > li ").each(function(){var e=o(this),t=e.find('select[name="column"]').val(),s=e.find('input[name="label"]').val(),a=e.find('input[name="name"]').val();"form_id"==t&&(a="hidden_form_id"),i[r]={column:t,name:a,label:s},r++});var t=o('input[name="skip_first"]').is(":checked"),s=o('input[name="import_delimiter"]').val(),a=o('input[name="import_enclosure"]').val();o.ajax({type:"post",url:ajaxurl,data:{action:"super_import_contact_entries",file_id:e,column_connections:i,skip_first:t,import_delimiter:s,import_enclosure:a},success:function(e){o(".super-export-import-entries .file-preview").html(e)}})}),e.on("click",".super-settings .export-entries",function(){var e=o(this),t=e.html(),s=e.data("type"),a=o('.super-export-import-entries input[name="from"]').val(),i=o('.super-export-import-entries input[name="till"]').val(),r=o('.super-export-import-entries input[name="delimiter"]').val(),n=o('.super-export-import-entries input[name="enclosure"]').val();e.html(super_settings_i18n.export_entries_working),o.ajax({type:"post",url:ajaxurl,data:{action:"super_export_entries",type:s,from:a,till:i,delimiter:r,enclosure:n},success:function(e){window.location.href=e},error:function(){alert(super_settings_i18n.export_entries_error)},complete:function(){e.html(t)}})}),e.on("click",".super-field .super-tags li",function(){var e=o(this).data("value"),t=o(this).parents(".super-field:eq(0)").find("textarea");o(this).parents(".super-tags:eq(0)").removeClass("active");var s=t.prop("selectionStart"),a=t.prop("selectionEnd"),i=t.val(),r=i.substring(0,s),n=i.substring(a,i.length);return t.val(r+e+n),!1}),e.on("click",".super-field .super-tags",function(){o(this).toggleClass("active")}),o(".super-settings .super-wrapper .super-fields .super-field textarea").each(function(){var e=o(".super-settings > .super-wrapper > .super-tags").clone();o(e).insertBefore(o(this))}),e.on("click",".super-settings .deactivate",function(){if(1==confirm(super_settings_i18n.deactivate_confirm)){var e=[];o(".super-fields .element-field").each(function(){e.push({name:o(this).attr("name"),value:o(this).val()})}),o(this).html(super_settings_i18n.deactivate_working),o.ajax({type:"post",url:ajaxurl,data:{action:"super_deactivate",data:e},success:function(e){if(null!=(e=o.parseJSON(e))&&"undefined"!==e.error)if(e.error){var t=o(".activation-msg").parents(".super-fields:eq(0)").index()-2;o(".super-tabs > li, .super-wrapper > .super-fields").removeClass("active"),o(".super-tabs li:eq("+t+")").addClass("active"),o(".super-wrapper .super-fields:eq("+t+")").addClass("active"),o(".activation-msg").html('<strong style="color:red;">'+e.msg+'</strong><br /><br /><span class="button super-button deactivate">Deactivate on current domain</span>')}else o(".activation-msg").html('<strong style="color:green;">'+e.msg+"</strong>")},error:function(){o(".save .message").removeClass("success").addClass("error").html(super_settings_i18n.deactivate_error)}})}}),e.on("click",".super-settings .restore-default",function(){1==confirm(super_settings_i18n.restore_default_confirm)&&(o(this).val(super_settings_i18n.restore_default_working),o.ajax({type:"post",url:ajaxurl,data:{action:"super_load_default_settings"},success:function(e){location.reload()},error:function(){o(".save .message").removeClass("success").addClass("error").html(super_settings_i18n.restore_default_error)}}))}),e.on("click",".super-settings .save-settings",function(){var s=o(this);s.html(super_settings_i18n.save_loading),o(".save .message").removeClass("error").removeClass("success");var i=[];o(".super-fields .element-field").each(function(){var e=o(this),t=!1;if(e.parents(".super-field.filter").each(function(){"none"==o(this).css("display")&&(t=!0)}),0==t){var s=e.attr("name"),a=e.val();""!=a&&i.push({name:s,value:a})}}),o.ajax({type:"post",url:ajaxurl,data:{action:"super_save_settings",data:i},success:function(e){if(null!=(e=o.parseJSON(e))&&"undefined"!==e.error&&"smtp_error"==e.error){o(".save .message").removeClass("success").addClass("error").html(e.msg);var t=o('input[name="smtp_username"]').parents(".super-fields:eq(0)").index()-1;return o(".super-tabs > li, .super-wrapper > .super-fields").removeClass("active"),o(".super-tabs li:eq("+t+")").addClass("active"),o(".super-wrapper .super-fields:eq("+t+")").addClass("active"),!1}s.html(super_settings_i18n.save_settings),o(".save .message").removeClass("error").addClass("success").html(super_settings_i18n.save_success)},error:function(){o(".save .message").removeClass("success").addClass("error").html(super_settings_i18n.save_error)}})}),e.on("click",".super-tabs li",function(){o(this).hasClass("save")||(o(".super-tabs li").removeClass("active"),o(this).addClass("active"),o(".super-wrapper .super-fields").removeClass("active"),o(".super-wrapper .super-fields:eq("+o(this).index()+")").addClass("active"),location.hash=o(this).index())}),""!=(i=window.location.hash.substring(1))){if("activate"==i)var i=o(".activation-msg").parents(".super-fields:eq(0)").index()-2;"export"==i&&(i=o(".super-export-import").parents(".super-fields:eq(0)").index()-2),"backend"==i&&(i=o('textarea[name="backend_contact_entry_list_fields"]').parents(".super-fields:eq(0)").index()-2),o(".super-tabs li").removeClass("active"),o(".super-tabs li:eq("+i+")").addClass("active"),o(".super-wrapper .super-fields").removeClass("active"),o(".super-wrapper .super-fields:eq("+i+")").addClass("active")}if("onhashchange"in window)window.onhashchange=function(){var e=window.location.hash.substring(1);""!=e&&(o(".super-tabs li").removeClass("active"),o(".super-tabs li:eq("+e+")").addClass("active"),o(".super-wrapper .super-fields").removeClass("active"),o(".super-wrapper .super-fields:eq("+e+")").addClass("active"))};else{var r=window.location.hash;window.setInterval(function(){if(window.location.hash!=r){var e=window.location.hash.substring(1);""!=e&&(o(".super-tabs li").removeClass("active"),o(".super-tabs li:eq("+e+")").addClass("active"),o(".super-wrapper .super-fields").removeClass("active"),o(".super-wrapper .super-fields:eq("+e+")").addClass("active"))}},100)}e.on("click",".super-settings .import-settings, .super-settings .load-default-settings",function(){var e="import",t=o(this),s=o('.super-export-import textarea[name="import-json"]').val();t.addClass("loading"),t.hasClass("load-default-settings")&&(e="load-default"),o.ajax({type:"post",url:ajaxurl,data:{action:"super_import_global_settings",settings:s,method:e},success:function(e){t.val(super_settings_i18n.save_settings),o(".save .message").removeClass("error").addClass("success").html(super_settings_i18n.save_success),location.reload()},error:function(){o(".save .message").removeClass("success").addClass("error").html(super_settings_i18n.save_error)},complete:function(){t.removeClass("loading")}})}),e.on("click",".super-settings .activate-add-on",function(){var e=o(this),t=e.parents(".super-field:eq(0)"),s=t.find('input[name="add_on"]').val(),a=t.find('input[name="license_'+s+'"]').val(),i=t.find(".add-on-activation-msg");e.html(super_settings_i18n.save_loading),o.ajax({type:"post",url:ajaxurl,data:{action:"super_activate_add_on",add_on:s,license:a},success:function(e){if(null!=(e=o.parseJSON(e))&&"undefined"!==e.error)if(e.error){var t=o(".activation-msg").parents(".super-fields:eq(0)").index()-2;o(".super-tabs > li, .super-wrapper > .super-fields").removeClass("active"),o(".super-tabs li:eq("+t+")").addClass("active"),o(".super-wrapper .super-fields:eq("+t+")").addClass("active"),i.html('<strong style="color:red;">'+e.msg+"</strong>")}else i.html('<strong style="color:green;">'+e.msg+"</strong>")},error:function(){alert("Failed to activate add-on")}})}),e.on("click",".super-settings .deactivate-add-on",function(){if(1==confirm(super_settings_i18n.deactivate_confirm)){var e=o(this),t=e.parents(".super-field:eq(0)"),s=t.find('input[name="add_on"]').val(),a=t.find('input[name="license_'+s+'"]').val(),i=t.find(".add-on-activation-msg");e.html(super_settings_i18n.deactivate_working),o.ajax({type:"post",url:ajaxurl,data:{action:"super_deactivate_add_on",add_on:s,license:a},success:function(e){if(null!=(e=o.parseJSON(e))&&"undefined"!==e.error)if(e.error){var t=o(".activation-msg").parents(".super-fields:eq(0)").index()-2;o(".super-tabs > li, .super-wrapper > .super-fields").removeClass("active"),o(".super-tabs li:eq("+t+")").addClass("active"),o(".super-wrapper .super-fields:eq("+t+")").addClass("active"),i.html('<strong style="color:red;">'+e.msg+'</strong><br /><br /><span class="button super-button deactivate-add-on">Deactivate on current domain</span>')}else i.html('<strong style="color:green;">'+e.msg+"</strong>")},error:function(){o(".save .message").removeClass("success").addClass("error").html(super_settings_i18n.deactivate_error)}})}}),e.on("click",".super-settings .export-forms",function(){var e=o(this),t=e.html();e.html(super_settings_i18n.export_entries_working),o.ajax({type:"post",url:ajaxurl,data:{action:"super_export_forms"},success:function(e){window.location.href=e},error:function(){alert(super_settings_i18n.export_forms_error)},complete:function(){e.html(t)}})}),o(".browse-forms-import-file").each(function(){var e,s=o(this),a=s.children(".button"),t=s.children(".file-preview"),i=s.children("input"),r=i.val();t.on("click","a.delete",function(){i.val(""),t.html("")}),a.on("click",function(){var t=a.html();a.html(super_settings_i18n.import_working),o(".ui-widget-overlay").hide(),s.parents(".shortcode-dialog").hide(),e||((e=wp.media.frames.downloadable_file=wp.media({title:"Select a TXT file",button:{text:"Add TXT"},library:{type:"text/plain"},multiple:!1})).on("select",function(){e.state().get("selection").map(function(e){"text/plain"!=(e=e.toJSON()).mime?alert("Selected file is not a TXT file!"):e.id&&(r=e.id,o.ajax({type:"post",url:ajaxurl,data:{action:"super_start_forms_import",file_id:r},success:function(e){window.location.href="edit.php?post_type=super_form",o("<div>"+super_settings_i18n.import_completed+"!</div>").insertAfter(a),a.remove()},error:function(){alert(super_settings_i18n.import_error)},complete:function(){a.html(t)}}))})}),e.on("close",function(){o(".ui-widget-overlay").show(),s.parents(".shortcode-dialog").show()})),e.open()})})});